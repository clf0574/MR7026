//======================Copyright (c)=====================================
// 文件名称: IT_Secre.H
// 功能描述:
/*
    //报文基本格式为：
    typedef struct
    {
        uint8  FrameType;       //帧控制        0x04
        uint8  FrameNum_H;      //帧序列号高字节
        uint8  dAddress;        //目标地址      0x0000
        uint8  FrameNum_L;      //帧序列号低字节
        uint8  NetID;           //网络ID        MY_ID   0x0000
        uint8  Channel_Or_Cmd;  //通道或命令    7654 通道数目,3210 通道
        uint8  DataLen;         //数据长度      n
        uint8  myData[PROTOCOL_IT1_DataSizeMax];   //数据  n*byte
    }PROTOCOL_IT1_DATA;

    每一帧不同的报文，帧序列号都需递增

    1.首先调用IT_SecretKey_Init，初始化密钥，不调用则按默认密钥处理
    2.发送IT报文时，首先按正常流程生成正常的报文,原CRC8位置保留一个字节即可，无须计算，
      然后调用IT_Encrypt，明文转换成密文，发送。 (CRC8校验已在函数内完成)
      加密14字节数据，注册报文大约需要230微秒，非注册报文2微秒，（keil5.14,72MHz,优化等级02)
    3.接收到一帧数据后（时间超时1.5个字符），调用IT_Decrypt，
      返回1，则成功解密，密文已转换成明文， 数据有效，(CRC8校验已在函数内完成)
      返回0，则数据无效,无需处理
      加密14字节数据，注册报文大约需要230微秒，非注册报文2微秒，（keil5.14,72MHz,优化等级02)

    Keil arm 编译方法：
    1.首先包含头文件 IT_Secre_STM32F103.H，然后把IT_Secre_STM32F103.lib放在源文件目录下
    2.在keil下把库文件添加到源文件列表
    3.编译
*/
// 修改记录:
//           2016-10-11, PiaoHong 创建文件
//
//
//========================================================================

#ifndef _IT_SECRE_H
#define _IT_SECRE_H

#ifdef _IT_SECRE_C
#define GLOBAL
#endif

#ifndef _IT_SECRE_C
#define GLOBAL extern
#endif

#define uint8 uint8_t
#define bool  uint8_t
//= Start ================================================================

//--------------------------------------------------------------
// 函数名称: IT_SecretKey_Init
// 功能描述: 密钥初始化
// 输入参数: 密钥所在地址 长度为8个字节
// 返回参数: 无
// 修改记录:
//           2016-10-10, PiaoHong 创建函数
//---------------------------------------------------------------
GLOBAL void IT_SecretKey_Init(uint8 *pKey);

//--------------------------------------------------------------
// 函数名称: IT_Encrypt
// 功能描述: IT报文加密
// 输入参数: IT报文明文(最后一个字节为Crc8位置)  (执行后会变成密文)
// 返回参数: 无
// 修改记录:
//           2016-10-10, PiaoHong 创建函数
//---------------------------------------------------------------
GLOBAL void IT_Encrypt(uint8 *s, uint8 len);

//--------------------------------------------------------------
// 函数名称: IT_Decrypt
// 功能描述: IT报文解密
// 输入参数: IT报文密文  (执行后会变成明文)
// 返回参数: 成功解析(CRC ok): true
// 修改记录:
//           2016-10-10, PiaoHong 创建函数
//---------------------------------------------------------------
GLOBAL bool IT_Decrypt(uint8 *s, uint8 len);

//= end   ================================================================
#undef GLOBAL

#endif //_IT_SECRE_H


