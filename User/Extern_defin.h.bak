
//============================================================================================
#ifndef _main_h
#define _main_h

	#ifdef MAIN_VARIABLE
		#define APP_EXT   
	#else
		#define APP_EXT extern       
	#endif
 
 
   
 //============================================================================================  
 
 #include "my_queue_chl.h"
  
 
 //============================================================================================ 
 
 //============================================================================================
 //³ÌĞòÉè±¸Ö¸¶¨
 //#define HT8201          
 //#define HT8202
 #define HT7203
 //============================================================================================

 //Ğ­Òé¶¨Òå 
 #define IT1         	       0 
 #define IT2 	 	       2
 #define FREE1 		       1  
 
 //============================================================================================
 //²úÆ·ÀàĞÍ¶¨Òå
 #define MYDEV_PANNEL      0
 #define MYDEV_SENSOR      1
 
 #define DEV_PANNEL_LIGHT   0x0401
 #define DEV_PANNEL_MOTO    0x0402
 #define DEV_PANNEL_SCENE   0x0403
 #define DEV_PANNEL_GENERAL 0x0404
 
 #define DEV_IT_TYPE 0xb100
	
 //===============================================================================================
 //È«¾Ö¶¨Òå
 //×ª·¢Æ÷ÔÚ¿ª·Å485ÖĞµÄÀàĞÍ
 #define DEV_OPEN_PROFILE_VER  0xA4
 #define DEV_OPEN_CHANNEL_NUM  10
 #define DEV_OPEN_VER          100
 #define DEV_IT_VER            100
 #define DEV_DEV_TYPE          0x61			//Éè±¸ÀàĞÍ£¬×ª·¢Æ÷ÔÚ¿ª·Å485ÖĞµÄÉè±¸ÀàĞÍ
 

 //==============================================================================================
 //ÓÃÓÚ¿ª·Å485Ğ­Òé£¬¶ÔITÏµÍ³À´Ëµ²»´æÔÚ
 //×ª·¢Æ÷Ä£Ê½
 #define DEV_MODE_PASS_THROUGH  0			//Í¸´«
 #define DEV_MODE_BY_BUFFER     1                       //Ê¹ÓÃ»º³å´¦Àí
 
 //==============================================================================================
 //×ª·¢Æ÷ÔÚ¶ÅÑÇIT2µÄÈ«¾Ö¶¨Òå
 #define DEV_IT2_VER     100
 
 //==============================================================================================
 //Éè±¸(×ª·¢Æ÷)ÔËĞĞ×´Ì¬ ×¢²áÌ¬ ÉèÖÃÌ¬£¨¶ÔÂë»òÑ§Ï°£©£¬Õı³£ÔËĞĞÌ¬
 #define DEV_REQUESTADDR        0
 #define DEV_REGISTER           DEV_REQUESTADDR+1
 #define DEV_NORMAL             DEV_REGISTER+1
 #define DEV_SETUP              DEV_NORMAL+1
 #define DEV_SETUP_OK           DEV_SETUP+1
 
 //×ª·¢±íÍ¨µÀ£¬»ò¿É×ª»»Éè±¸ÊıÄ¿
 #define EX_TABLE_NUM           8
 #define REG_START_ADDR         0x30			//¼Ä´æÆ÷
 #define REG_MODE1_ADDR         0x2f                    //ÊÇ·ñÍ¸´«(Ä¬ÈÏÎªÍ¸´«£¬Ö÷¶¯ÉÏ±¨,»òÕß¼Ä´æÆ÷¶ÁÈ¡)
 
 //==============================================================================================
 //Ä¬ÈÏÍø¹ØµØÖ·,ÓÃÓÚITÏµÍ³£¬¶Ô¿ª·Å485Ğ­Òé²»´æÔÚ
 #define Master_Address 0x0000  //Íø¹ØµØÖ·
 
 //==============================================================================================
 //³ÌĞò·µ»Ø×´Ì¬£¬´íÎó£¬ÕıÈ·£¬ºöÔ½
 #define RE_ERR 0xFF				//0xff
 #define RE_OK  RE_ERR-1			//0xfe
 #define RE_CANCEL RE_OK-1			//0xfd
 //³ÌĞò²ÎÊı ÕıÈ· ´íÎó
 #define OPT_ERR RE_CANCEL-1			//0xfc
 #define OPT_OK  OPT_ERR-1			//0xfb
 #define OPT_CANCEL OPT_OK-1
 
 //È«¾Ö±äÁ¿£¬´íÎó±ê¼Ç
 #define ERR_EEPROM       0x80
 #define ERR_WIRELESS     0x40
 #define ERR_UART         0x20
 #define ERR_POWER        0x10                         //µçÑ¹´íÎó£¬µÍÑ¹
 //=================================================================================================
 //Ïà¶ÔÎŞÏßÉè±¸À´Ëµ
 #define EX_DEV_MOTOR_R    0x02
 #define EX_DEV_MOTOR_E    0x04
 #define EX_DEV_BLIND_R    0x12
 #define EX_DEV_BLIND_E    0x11
 #define EX_DEV_SOCKET     0x21
 #define EX_DEV_LIGHT      0x31
 #define EX_DEV_LIGHT_ADJ  0x33

 #define EX_DEV_KEY        0xf0
 //===============================================================================================
 //Ö»ÓÃÓÚITĞ­Òé
 #define EX_KEY_SCENE  		0xf0
 #define EX_KEY_MOTOR  		0xf1
 #define EX_KEY_LIGHT  		0xf2
 #define EX_KEY_GENERAL 	0xf3
 #define LEARN_TIME_MAX 10
 #define ENCODE_TIME_MAX 5
 
 //===============================================================================================

 //===============================================================================================
 //ÒÔÏÂÈ«¾Ö±äÁ¿¶¨Òå
 //Éè±¸Êı¾İ½á¹¹
 typedef struct __Dev
 {
  //¹«ÓÃ²¿·Ö
	uint8_t   profile;									//Ê¹ÓÃµÄ485Ğ­Òé
  //uint8_t   ID[8];							  //Éè±¸Î¨Ò»ID
	uint8_t   flag;											//bit0-µÍÑ¹±ê¼Ç bit1-ÊÇ·ñĞ´EPROM±ê¼Ç bit2-×ª·¢±í±¸·İ±ê¼Ç
	uint8_t   addr[2];									//Éè±¸µØÖ·,ITĞ­ÒéÓÃaddr[0],¿ª·Å485Ğ­Òéaddr[0]-ID_L,addr[1]-ID_H
	uint16_t  type;										  //Éè±¸ÀàĞÍ
  uint8_t   stu;										  //Éè±¸¹¤×÷×´Ì¬
	uint8_t   rand;										  //Ëæ»úÊı
	uint8_t   serial;                                                                       //·¢ËÍĞòÁĞºÅ
	uint8_t   power_time;								//ÉÏµçÊ±¼ä
	uint8_t   wireless_busy;						//ÎŞÏßÃ¦£
	uint8_t   learn_time;
	uint8_t   encode_time;									//
	uint8_t   mode;									        ///Í¨Ñ¶Ä£Ê½£¬Í¸´«»ò»º³å
	uint8_t   err;									        //´íÎó×´Ì¬
		
 }_Dev;
 APP_EXT _Dev Dev;
 //×ª·¢Æ÷ ×ª·¢±í½á¹¹
 //×ª·¢±íĞ´Èë£¬ÊÇ°´ÌõÄ¿Ğ´ÈëµÄ£¬ĞŞ¸ÄÕâÀïĞèĞŞ¸ÄWrite_Ex_Tableº¯Êı
 typedef struct __Exchange
 {
	uint8_t    type;								       //¶ÔÓ¦ÎŞÏßµÄÉè±¸ÀàĞÍ
	uint8_t    addr;
	uint8_t    stu;    										 //µç»úÕıÏò»ò·´Ïò µÈĞÅÏ¢                    						
  	uint8_t    wl_addr[3];
	uint8_t    channel;							        		
 }_Exchange;

 typedef struct _Ex_Table
 {
	uint8_t    index;
	uint8_t    count;	
	uint8_t    stu[EX_TABLE_NUM];					 			//×îºóÒ»¸öÃüÁî×´Ì¬
  	uint8_t    rtdat[EX_TABLE_NUM];	       							//·µ»ØÊı¾İ,ÎŞĞ§0xff,0-100ÓĞĞ§£¬±íÊ¾µÆ¿ª¹ØºÍµç»úĞĞ³Ì		
	_Exchange  Exchange[EX_TABLE_NUM];	
  	uint16_t   tmpdat;										 //ÁÙÊ±Êı¾İ	 
 }_Ex_Table;

 APP_EXT _Exchange Exchangebuf;
 APP_EXT _Ex_Table Ex_Table;
 
 //===============================================================================================
 //³¡¾°Êı¾İ½á¹¹-ÓÃÓÚ×ª·¢Æ÷
 //¹²Ğè×Ö½Ú (10*50+2)*8=4016¸ö×Ö½Ú
  typedef struct __S_item
 {
 	uint8_t    flag;
	uint16_t   id;			//³¡¾°ºÅ
	uint8_t    chl;                 //Í¨µÀºÅ                						
  	uint8_t    dat[4];	        //Êı¾İ	
	uint16_t   dlytime;		//ÑÓÊ±Ê±¼ä							        		
 }_S_item;
 
 typedef struct __S_Dev
 {
	uint8_t    num;                 //³¡¾°¸öÊı
	_S_item    item[50];            //Ò»¸öÉè±¸ ×Ü¹²ÓĞ50¸ö³¡¾°
	uint8_t    check_sum;		//ÀÛ¼ÓºÍ							                   													        		
 }_S_Dev;
 
 APP_EXT _S_Dev Scene[8];		//Ò»¸ö×ª·¢Æ÷ ×î¶àÓĞ8¸öÉè±¸
 
 
 
 //===============================================================================================
 //====================================================================================
//°´¼üÅäÖÃ±í¸ñ
#ifdef HT8201
 #define KEY_NUM   8
#elif defined HT8202
 #define KEY_NUM   4
#elif defined HT7203
 #define KEY_NUM   8
#endif
 
 
#define KEY_ITEM_NUM  32
typedef struct __PANNEL_ITEM
{
	uint8_t flag;		//±ê¼Ç£¬±íÊ¾ÊÇ·ñÊ¹ÓÃ
	uint8_t type;		//ÀàĞÍ Éè±¸ ³¡¾° ĞòÁĞ ·´Ïò
	uint8_t tg_id;		//Ä¿±êµØÖ·
	uint8_t datalen;	//Êı¾İ×Ö½Ú³¤¶È
	uint8_t buf[25];	//Êı¾İ
}_PANNEL_ITEM;  

typedef struct __PANNEL_TABLE
{
	uint8_t cnt;		//ÒÑÅäÍ¨µÀ×ÜÊı
	_PANNEL_ITEM item[KEY_NUM];
}_PANNEL_TABLE;

APP_EXT _PANNEL_TABLE Pannel;		//Ãæ°å°´¼üÊı¾İ¿â 

//========================================================================================================
typedef struct __ARRAY_BUF
{
	uint16_t id;
	uint8_t mode;
	uint16_t dly;
		
}_ARRAY_BUF;

typedef struct __ARRAY
{
	uint8_t flag;
	uint8_t key;
	uint8_t index;
	uint8_t cnt;
	_ARRAY_BUF buf[10];
}_ARRAY;
APP_EXT _ARRAY Array;		//
//====================================================================================== 

 //===============================================================================================
 //ÓÃÓÚ´®¿Ú
 //½ÓÊÕ»º³åÇø½á¹¹
 #define RX_MAX 200
 #define RX_IDLE 0
 #define RX_BUSY 1
 typedef struct __RxDat
 {
	uint8_t cnt;					//½ÓÊÕ¸öÊı
	uint8_t index;					//½ÓÊÕÖ¡ĞòÁĞºÅ
	uint8_t buf[RX_MAX];                            //½ÓÊÕ»º³åÇø
	uint8_t stu;					//×´Ì¬0-¿ÕÏĞ;1-ÕıÔÚ½ÓÊÕ;2-µÈ´ı·¢ËÍ
 }_RxDat;

 APP_EXT _RxDat RxDat;

 //·¢ËÍ»º³åÇø½á¹¹
 #define TX_MAX 30
 #define TX_IDLE 0
 #define TX_BUSY 1
 typedef struct __TxDat
 {
	uint8_t cnt;					//½ÓÊÕ¸öÊı
	uint8_t index;					//½ÓÊÕÖ¡ĞòÁĞºÅ
	uint8_t f_tx;
	uint8_t buf[TX_MAX];            		//½ÓÊÕ»º³åÇø
	uint8_t stu;					//×´Ì¬0-¿ÕÏĞ;1-ÕıÔÚ½ÓÊÕ;2-ÕıÔÚ´¦Àí
	//uint8_t isoffline;				//ÊÇ·ñÀëÏß
 }_TxDat;

 APP_EXT _TxDat TxDat;

 //=====================================================================================================
 //ÓÃÓÚ×ÜÏß¼ì²â
 typedef struct __BusStu
 {
	uint8_t 	WaitForSend;
	uint8_t     	SelfSend;
	uint8_t 	time;
	uint8_t 	interval;
    	uint8_t     	randtime;
    	uint16_t     	distime;
    	uint8_t         rxok;				//2016.3.5 add
 }_BusStu;
 APP_EXT _BusStu Bus;
 
 //====================================================================================================
 //ÓÃÓÚ±¾µØÊ±¼ä
  typedef struct __Time
 {
	uint8_t 	year;
	uint8_t     	month;
	uint8_t 	time;
	uint8_t 	date;
    	uint8_t     	hour;
    	uint8_t     	min;
    	uint8_t         sec;				//2016.3.5 add
 }_Time;
 APP_EXT _Time Time;

 //=====================================================================================================
 //485·¢ËÍ»º³å¶ÓÁĞ£¬ÎŞÏß·¢ËÍ»º³å
 APP_EXT QueueBUF RS485_Queue,WirelessSend_Queue;


//================================================================================================
//============================ÒÔÏÂ¿ÉÄÜĞèÒªĞŞ¸Ä====================================================

//================================================================================================
//=================================================================================================
//============================µ÷ÊÔÄ£Ê½½øÈë=========================================================
    #define DEBUG			

//=================================================================================================
//=================================================================================================
//============================³ÌĞòÓÃµ½³£Á¿=========================================================
//=================================================================================================   
  
     
    #define RS485_RX_MAX 		26//20
    #define WIRELESS_RX_MAX 		20
    

    #define RESEND_MAX			5	//×î´óÖØ·¢´ÎÊı

    
    #define LED_OFF_FOREVER    		0XFF	
    #define LED_ON_FOREVER   		0XFF
    #define LED_LOOP_FOREVER  		0XFF
    
    #define RED_LED   			0
    #define GRE_LED   			1    
    
    #define RS485_NO_ASK                0
    #define RS485_DO_ASK                1
         
    #define LEARN_DLY_TIME      	8				//Ñ§Ï°Ê±¼ä8Ãë
    #define ENCODE_DLY_TIME     	3				//¶ÔÂëÊ±¼ä2Ãë
    #define FRAME_DELAY             20
    
    #define TRUE 					1
    #define FALSE					0
    #define NULL    				0


//=================================================================================================
//=================================================================================================
//=================================================================================================  


//=================================================================================================
//=================================================================================================
//============================Êı¾İ½á¹¹ºÍ±äÁ¿¶¨Òå===================================================
//=================================================================================================   





#endif
//================================================================================================= 
//=======================================================================================
